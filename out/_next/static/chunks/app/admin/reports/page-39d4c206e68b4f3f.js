(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{865:(e,t,s)=>{Promise.resolve().then(s.bind(s,41953))},26071:(e,t,s)=>{"use strict";s.d(t,{AdminLayout:()=>f});var a=s(95155),r=s(12115),i=s(6874),l=s.n(i),n=s(35695),d=s(40283),o=s(67110),c=s(64219),x=s(12513),m=s(5500),h=s(26884),u=s(74500),p=s(32461),g=s(69598);let j=[{id:"students",name:"Estudiantes",icon:c.A,href:"/admin/students"},{id:"users",name:"Usuarios",icon:x.A,href:"/admin/users"},{id:"reports",name:"Reportes",icon:m.A,href:"/admin/reports"},{id:"schedules",name:"Horarios",icon:h.A,href:"/admin/schedules"}],f=e=>{let{children:t,activeSection:s="students"}=e,{user:i}=(0,d.A)(),c=(0,n.useRouter)(),[x,m]=(0,r.useState)(!1),h=()=>{c.push("/")};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>m(!1)}),(0,a.jsxs)("div",{className:"\n        fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out\n        lg:translate-x-0 ".concat(x?"translate-x-0":"-translate-x-full","\n      "),children:[(0,a.jsxs)("div",{className:"flex items-center justify-center h-20 px-4 border-b border-gray-200",children:[(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(o.gu,{size:"xl",showText:!1})}),(0,a.jsx)("button",{onClick:()=>m(!1),className:"lg:hidden p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 absolute right-2",children:(0,a.jsx)(u.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("nav",{className:"mt-8 px-4",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("button",{onClick:h,className:"w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100 hover:text-gray-900 transition-colors border border-gray-200",children:[(0,a.jsx)(p.A,{className:"mr-3 h-5 w-5"}),"Volver al Inicio"]})}),(0,a.jsx)("ul",{className:"space-y-2",children:j.map(e=>{let t=e.icon,r=s===e.id;return(0,a.jsx)("li",{children:(0,a.jsxs)(l(),{href:e.href,className:"\n                      flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors\n                      ".concat(r?"bg-blue-100 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-100 hover:text-gray-900","\n                    "),children:[(0,a.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]})},e.id)})})]}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200",children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:null==i?void 0:i.name})})})})})]}),(0,a.jsxs)("div",{className:"lg:pl-64",children:[(0,a.jsxs)("div",{className:"lg:hidden bg-white shadow-sm border-b border-gray-200 px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>m(!0),className:"p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:h,className:"p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100",title:"Volver al Inicio",children:(0,a.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,a.jsx)(o.gu,{size:"xl",showText:!1}),(0,a.jsx)("div",{className:"w-10"})]}),(0,a.jsx)("header",{className:"hidden lg:block bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Sistema de Retiro - Administraci\xf3n"})})}),(0,a.jsx)("main",{className:"px-4 lg:px-6 py-4 lg:py-8",children:t})]}),(0,a.jsxs)("div",{className:"fixed bottom-4 left-4 space-y-2 z-30",children:[(0,a.jsx)(o.j_,{}),(0,a.jsx)(o.p2,{})]})]})}},41953:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var a=s(95155),r=s(26071),i=s(12115),l=s(64849),n=s(67110),d=s(6711),o=s(19828),c=s(10415),x=s(83540),m=s(90170),h=s(10627),u=s(54811),p=s(27086),g=s(64683),j=s(6046),f=s(94754),y=s(96025),b=s(52071),v=s(70022),N=s(12513),w=s(82771),k=s(5500),_=s(72227),C=s(47359),A=s(74500);let D=()=>{let{studentsWithCourses:e,courses:t,pickupLogs:s,authorizedPersons:r}=(0,l.E)(),[D,E]=(0,i.useState)({dateStart:"",dateEnd:"",student:"",course:"",relationship:""}),R=r.reduce((e,t)=>{let a=s.filter(e=>e.authorized_person_id===t.id).length,r=e.find(e=>e.relationship===t.relationship);return r?r.count+=a:e.push({relationship:t.relationship,count:a}),e},[]),S=(()=>{let e=[],t=(e,t,a,r)=>s.filter(s=>{let i=new Date(s.pickup_timestamp),l=60*i.getHours()+i.getMinutes();return l>=60*e+t&&l<60*a+r}).length,a=t(8,0,16,0);e.push({hour:"08:00-16:00",pickups:a}),[{start:[16,5],end:[16,10],label:"16:05-16:10"},{start:[16,10],end:[16,15],label:"16:10-16:15"},{start:[16,15],end:[16,20],label:"16:15-16:20"},{start:[16,20],end:[16,25],label:"16:20-16:25"}].forEach(s=>{let a=t(s.start[0],s.start[1],s.end[0],s.end[1]);e.push({hour:s.label,pickups:a})});let r=t(16,30,18,30);return e.push({hour:"16:30-18:30",pickups:r}),e})(),z=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#F97316","#06B6D4","#84CC16"],F=e.length,L=(0,d.o)(new Date),H=(0,o.D)(new Date),P=s.filter(e=>{let t=new Date(e.pickup_timestamp);return t>=L&&t<=H}).length,T=s.length,M=Math.round(T/7),B=[{title:"Total Estudiantes",value:F,icon:N.A,color:"bg-blue-500"},{title:"Retiros Hoy",value:P,icon:w.A,color:"bg-green-500"},{title:"Total Retiros",value:T,icon:k.A,color:"bg-purple-500"},{title:"Promedio/D\xeda",value:M,icon:_.A,color:"bg-orange-500"}],W=s.filter(s=>{let a=new Date(s.pickup_timestamp),i=!0;if(D.dateStart&&D.dateEnd){let e=(0,d.o)(new Date(D.dateStart)),t=(0,o.D)(new Date(D.dateEnd));i=a>=e&&a<=t}else D.dateStart?i=a>=(0,d.o)(new Date(D.dateStart)):D.dateEnd&&(i=a<=(0,o.D)(new Date(D.dateEnd)));let l=!0;if(D.student){let t=e.find(e=>e.id===s.student_id);l=(t?t.full_name.toLowerCase():"").includes(D.student.toLowerCase())}let n=!0;if(D.course){let a=e.find(e=>e.id===s.student_id),r=t.find(e=>e.id===(null==a?void 0:a.course_id));n=!!r&&r.name.toLowerCase().includes(D.course.toLowerCase())}let c=!0;if(D.relationship){let e=r.find(e=>e.id===s.authorized_person_id);c=!!e&&e.relationship.toLowerCase().includes(D.relationship.toLowerCase())}return i&&l&&n&&c}).sort((e,t)=>new Date(t.pickup_timestamp).getTime()-new Date(e.pickup_timestamp).getTime()).slice(0,20),Z=t.map(e=>e.name).sort(),G=[...new Set(r.map(e=>e.relationship))].sort();return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Reportes y Estad\xedsticas"}),(0,a.jsx)("p",{className:"text-gray-600",children:"An\xe1lisis detallado de retiros de estudiantes"})]}),(0,a.jsxs)(n.$n,{onClick:()=>{let t=new Blob([[["Fecha","Estudiante","Curso","Persona Autorizada","Relaci\xf3n","Registrado Por"],...s.map(t=>{let s=e.find(e=>e.id===t.student_id),a=r.find(e=>e.id===t.authorized_person_id);return[(0,c.GP)(new Date(t.pickup_timestamp),"dd/MM/yyyy HH:mm"),(null==s?void 0:s.full_name)||"",(null==s?void 0:s.course.name)||"",(null==a?void 0:a.full_name)||"",(null==a?void 0:a.relationship)||"",t.recorded_by_user]})].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download="retiros_".concat((0,c.GP)(new Date,"yyyy-MM-dd"),".csv"),i.click()},className:"flex items-center",children:[(0,a.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Exportar CSV"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map(e=>{let t=e.icon;return(0,a.jsx)(n.Zp,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat(e.color),children:(0,a.jsx)(t,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]})]})},e.title)})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsx)(n.Zp,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Retiros por Tipo de Persona Autorizada"}),(0,a.jsx)(x.u,{width:"100%",height:450,children:(0,a.jsxs)(m.r,{margin:{top:20,right:30,bottom:80,left:30},children:[(0,a.jsx)(h.F,{data:R,cx:"50%",cy:"45%",labelLine:!1,label:e=>{let{percent:t}=e;return"".concat(t?(100*t).toFixed(1):0,"%")},outerRadius:100,innerRadius:35,fill:"#8884d8",dataKey:"count",stroke:"#ffffff",strokeWidth:2,children:R.map((e,t)=>(0,a.jsx)(u.f,{fill:z[t%z.length],stroke:"#ffffff",strokeWidth:2},"cell-".concat(t)))}),(0,a.jsx)(p.m,{formatter:e=>["".concat(e," retiros")],labelFormatter:e=>"".concat(e)}),(0,a.jsx)(g.s,{verticalAlign:"bottom",height:60,wrapperStyle:{paddingTop:"20px"},content:()=>(0,a.jsx)("div",{className:"flex flex-wrap justify-center gap-4 mt-4",children:R.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:z[t%z.length]}}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.relationship})]},e.relationship))})})]})})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Distribuci\xf3n de Retiros por Rangos de Hora"}),(0,a.jsx)(x.u,{width:"100%",height:400,children:(0,a.jsxs)(j.b,{data:S,margin:{top:20,right:30,left:20,bottom:80},children:[(0,a.jsx)(f.d,{strokeDasharray:"3 3"}),(0,a.jsx)(y.W,{dataKey:"hour",angle:-45,textAnchor:"end",height:90,fontSize:11}),(0,a.jsx)(b.h,{allowDecimals:!1,domain:[0,"dataMax"],tickCount:6}),(0,a.jsx)(p.m,{formatter:e=>["".concat(e," retiros"),"N\xfamero de retiros"],labelFormatter:e=>"Horario: ".concat(e)}),(0,a.jsx)(g.s,{}),(0,a.jsx)(v.N,{type:"monotone",dataKey:"pickups",stroke:"#8B5CF6",name:"Retiros",strokeWidth:2,dot:{r:4}})]})})]})})]}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Retiros Recientes"}),(0,a.jsxs)("button",{onClick:()=>{E({dateStart:"",dateEnd:"",student:"",course:"",relationship:""})},className:"flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",title:"Limpiar todos los filtros",children:[(0,a.jsx)(A.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Limpiar Filtros"})]})]}),(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"Fecha/Hora"}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("input",{type:"date",value:D.dateStart,onChange:e=>E(t=>({...t,dateStart:e.target.value})),className:"w-20 px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Desde"}),(0,a.jsx)("input",{type:"date",value:D.dateEnd,onChange:e=>E(t=>({...t,dateEnd:e.target.value})),className:"w-20 px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Hasta"})]})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"Estudiante"}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar nombre...",value:D.student,onChange:e=>E(t=>({...t,student:e.target.value})),className:"w-32 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"Curso"}),(0,a.jsxs)("select",{value:D.course,onChange:e=>E(t=>({...t,course:e.target.value})),className:"w-32 px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Todos"}),Z.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"Persona Autorizada"}),(0,a.jsxs)("select",{value:D.relationship,onChange:e=>E(t=>({...t,relationship:e.target.value})),className:"w-36 px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Todas"}),G.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{children:"Registrado Por"}),(0,a.jsx)("div",{className:"text-xs text-gray-400 italic",children:"Sin filtro"})]})})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map(t=>{let s=e.find(e=>e.id===t.student_id),i=r.find(e=>e.id===t.authorized_person_id);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,c.GP)(new Date(t.pickup_timestamp),"dd/MM/yyyy HH:mm")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:null==s?void 0:s.full_name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:null==s?void 0:s.course.name})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:null==i?void 0:i.full_name}),(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:null==i?void 0:i.relationship})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.recorded_by_user})]},t.id)})})]}),0===W.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:D.dateStart||D.dateEnd||D.student||D.course||D.relationship?"No se encontraron retiros con los filtros aplicados":"No hay retiros registrados"})]})]})})]})};function E(){return(0,a.jsx)(r.AdminLayout,{activeSection:"reports",children:(0,a.jsx)(D,{})})}}},e=>{e.O(0,[647,134,590,691,432,643,110,441,964,358],()=>e(e.s=865)),_N_E=e.O()}]);